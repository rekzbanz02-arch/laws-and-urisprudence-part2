<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messenger: @Rekz Banz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #19124e;
      color: #fefeff;
    }
    h1 { color: #fefeff; }
    button {
      padding: 15px 30px;
      font-size: 20px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: default; }
    .question { margin-bottom: 25px; }
    .correct { color: #00ff88; font-weight: bold; }
    .wrong { color: #ff5577; font-weight: bold; }
    .highlight { margin-top: 10px; }
    input[type="radio"] { transform: scale(1.5); margin-right: 10px; }
    #finishBtn { font-size: 2em; padding: .1em 1em; }
    .nav-buttons { margin-top: 20px; display: flex; gap: 10px; }

    #codeInput {
      font-size: 15px;
      padding: 10px 20px;
      width: 300px;
      border-radius: 8px;
      border: 2px solid #888;
    }

    #codeInput::placeholder { font-size: 15px; }

    /* Smaller font for Enter Access Code */
    #accessSection h2 {
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    /* Style for filename display above access code */
    #fileDisplay {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 5px;
      color: #9fe3ff;
    }
  </style>
</head>

<body>
  <div id="accessSection">
    <p id="fileDisplay"></p> <!-- NEW filename display -->
    <h2>Enter Access Code</h2>
    <input type="password" id="codeInput" placeholder="Enter code here" />
    <br>
    <button type="button" id="accessSubmit" style="padding:10px 40px; font-size:20px;">Login</button>

    <span id="contactLink" style="margin-left:16px; font-size:14px; text-decoration:underline; cursor:pointer; color:#9fe3ff;">
     Contact here! 
    </span>


    <p id="message" aria-live="polite"></p>
    <br>
    <p id="tipsArea">Loading tips...</p>
  </div>

  <div id="mainContent" style="display:none;">
    <div id="reviewerSection">
      <h1>Reviewer: Laws & Jurisprudence-(Part2)</h1>
 
 
 
      <button onclick="showQuiz()">Start Quiz</button>
    </div>

    <div id="quizSection" style="display:none;">
      <h1>Quiz: Laws & Jurisprudence-(Part2)</h1>
      <p style="font-size: 15px; font-weight: 600; margin: 0;">Multiple-Choice Quiz (random items)</p>
      <form id="quizForm"></form>

      <div class="nav-buttons">
        <button id="finishBtn">Score</button>
        <button type="button" onclick="refreshQuiz()">Restart Quiz</button>
        <button type="button" onclick="backToReviewer()">Reviewer</button>
      </div>
      <div id="result" class="highlight"></div>
    </div>
  </div>

<!-- CONTACT POPUP MODAL -->
<div id="contactModalBG" style="
  display:none; 
  position:fixed; 
  top:0; left:0; 
  width:100%; height:100%; 
  background:rgba(0,0,0,0.6); 
  z-index:1000;
">
  <div id="contactModal" style="
    background:#ffffff; 
    color:#000; 
    width:90%; 
    max-width:450px; 
    margin:80px auto; 
    padding:25px; 
    border-radius:12px; 
    box-shadow:0 0 15px rgba(0,0,0,0.5);
  ">

    <h2 style="margin-top:0; font-size:22px; text-align:center;">
      Fill-in with your details here. <br>I'll contact you shortly!
    </h2>

    <label>Name:</label>
    <input id="c_name" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Contact No.:</label>
    <input id="c_contact" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Social Media Account:</label>
    <input id="c_social" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Request / Comment:</label>
    <textarea id="c_request" style="width:100%; padding:8px; margin-bottom:10px; height:80px;"></textarea>

    <button id="c_submit" style="
      width:100%; padding:10px; 
      background:#007BFF; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Submit</button>

    <button id="c_close" style="
      width:100%; padding:10px; 
      background:#444; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Close</button>
<!--
    <p style="margin-top:20px; font-size:20px; text-align:center; color:#333;">
      or you can contact this messenger: <b>@Rekz Banz</b>
    </p>
-->

  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  // ===== Display filename on login page =====
  const quizTitleEl = document.querySelector("#quizSection h1");
  const displayFileName = quizTitleEl ? quizTitleEl.textContent.replace("Quiz: ", "").trim() : "index.html";
  const fileDisplay = document.getElementById("fileDisplay");
  if (fileDisplay) fileDisplay.textContent = displayFileName;

  // ===== SETTINGS =====
  const BIN_URL_CODE = "https://api.jsonbin.io/v3/b/6912d50eae596e708f51dade/latest";
  const BIN_URL_TIPS = "https://api.jsonbin.io/v3/b/68f1b652ae596e708f180d5d/latest";
  const MASTER_KEY_CODE = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";
  const MASTER_KEY_TIPS = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";

  // === LOGGER BIN (Access Log) ===
  const BIN_URL_LOG = "https://api.jsonbin.io/v3/b/6911a123d0ea881f40df102a";
  const MASTER_KEY_LOG = MASTER_KEY_CODE;

  // === SCORE LOG BIN (New) ===
  const BIN_URL_SCORE = "https://api.jsonbin.io/v3/b/6912985cd0ea881f40e0cf7c";
  const MASTER_KEY_SCORE = MASTER_KEY_CODE;

  // ===== ELEMENTS =====
  const accessSection = document.getElementById("accessSection");
  const mainContent = document.getElementById("mainContent");
  const codeInput = document.getElementById("codeInput");
  const accessSubmit = document.getElementById("accessSubmit");
  const message = document.getElementById("message");
  const tipsArea = document.getElementById("tipsArea");

// ===============================
// CONTACT MODAL LOGIC (WORKING)
// ===============================

// open modal
const contactLink = document.getElementById("contactLink");
const contactBG = document.getElementById("contactModalBG");
const contactClose = document.getElementById("c_close");
const contactSubmit = document.getElementById("c_submit");

if (contactLink && contactBG) {
  contactLink.addEventListener("click", () => {
    contactBG.style.display = "block";
  });
}

if (contactClose && contactBG) {
  contactClose.addEventListener("click", () => {
    contactBG.style.display = "none";
  });
}
// ===============================
// CONTACT SUBMISSION SAVE LOGIC
// ===============================
const BIN_CONTACT_LOG = "https://api.jsonbin.io/v3/b/69146372d0ea881f40e3989e";
const MASTER_KEY_CONTACT = MASTER_KEY_CODE;

if (contactSubmit) {
  contactSubmit.addEventListener("click", async () => {
    const name = document.getElementById("c_name").value.trim();
    const contact = document.getElementById("c_contact").value.trim();
    const social = document.getElementById("c_social").value.trim();
    const request = document.getElementById("c_request").value.trim();

    if (!name || !contact || !request) {
      alert("Please fill out name, contact, and request/comment.");
      return;
    }

    const quizTitleElLocal = document.querySelector("#quizSection h1");
    const fileName = quizTitleElLocal
      ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim()
      : "index.html";

    const deviceInfo = await getDeviceInfo();

    try {
      const getRes = await fetch(`${BIN_CONTACT_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_CONTACT }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      logs.push({
        event: "Client Request",
        request,
        name,
        contact,
        social,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_CONTACT_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_CONTACT
        },
        body: JSON.stringify(logs)
      });

      alert("Message sent!");
      contactBG.style.display = "none";

    } catch (err) {
      alert("Error sending contact message.");
      console.error(err);
    }
  });
}



  // ===== HELPERS =====
  function findStringKey(obj, keyName) {
    if (!obj || typeof obj !== "object") return undefined;
    for (const k in obj) {
      if (k.toLowerCase() === keyName.toLowerCase() && typeof obj[k] === "string") {
        return obj[k];
      }
      const v = obj[k];
      if (typeof v === "object") {
        const nested = findStringKey(v, keyName);
        if (nested) return nested;
      }
    }
  }

  async function getDeviceInfo() {
    const uaData = navigator.userAgentData || {};
    const ua = navigator.userAgent;
    const platform = navigator.platform;
    const language = navigator.language;
    const screenResolution = `${window.screen.width}x${window.screen.height}`;
    const browserVersion = uaData.brands
      ? uaData.brands.map(b => `${b.brand} ${b.version}`).join(", ")
      : ua;

    // Determine general device type
    const uaLower = ua.toLowerCase();
    let deviceType = "desktop";
    if (/mobi|iphone|android/i.test(uaLower)) {
      deviceType = "mobile";
    } else if (/tablet|ipad|nexus 7|nexus 10/i.test(uaLower)) {
      deviceType = "tablet";
    }

    // Get approximate IP + region/country info (non-identifying)
    let networkInfo = "Unavailable";
    try {
      const res = await fetch("https://ipapi.co/json/");
      if (res.ok) {
        const info = await res.json();
        networkInfo = {
          ip: info.ip,
          city: info.city,
          region: info.region,
          country: info.country_name,
          org: info.org
        };
      }
    } catch {
      networkInfo = "Network lookup failed";
    }

    // Optional: request geolocation with user consent
    const location = await new Promise(resolve => {
      if (!navigator.geolocation) return resolve("Geolocation not supported");
      navigator.geolocation.getCurrentPosition(
        pos => resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy
        }),
        () => resolve("Permission denied or unavailable"),
        { timeout: 5000 }
      );
    });

    return {
      ua,
      browserVersion,
      platform,
      language,
      screenResolution,
      deviceType,
      networkInfo,
      location
    };
  }

  async function saveLoginToJsonBin(codeUsed) {
    try {
      // get filename from quiz title h1
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_LOG }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Login Access",
        accessCode: codeUsed,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_LOG
        },
        body: JSON.stringify(logs)
      });

      console.log(`‚úÖ Login logged successfully (file: ${fileName}).`);
    } catch (err) {
      console.error("‚ùå Error logging to JSONBin:", err);
    }
  }

  // ===== LOAD TIPS =====
  async function loadTips() {
    try {
      const resp = await fetch(BIN_URL_TIPS, {
        headers: { "X-Master-Key": MASTER_KEY_TIPS, "Content-Type": "application/json" }
      });
      const data = await resp.json();
      const tipsText =
        findStringKey(data, "tips") ||
        "Tips: <br>Press Enter after typing the code.<br>Stay online when entering.<br>For help, contact messenger: @Rekz Banz";
      tipsArea.innerHTML = tipsText;
    } catch (err) {
      console.error("Tips fetch error:", err);
      tipsArea.innerHTML =
        "Could not load page. Please check your internet connection.";
    }
  }
  loadTips();

  // === NEW FUNCTION: Save Quiz Score to JSONBin ===
  async function saveScoreToJsonBin(score, total) {
    try {
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_SCORE}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_SCORE }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];
      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Quiz Score",
        score: `${score}/${total}`,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_SCORE, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_SCORE
        },
        body: JSON.stringify(logs)
      });
      console.log("‚úÖ Quiz score saved to JSONBin successfully.");
    } catch (err) {
      console.error("‚ùå Error saving quiz score:", err);
    }
  }

  // ===== LOCAL STORAGE =====
  const fileName = window.location.pathname.split("/").pop() || "default";
  const storageKey = "savedAccessCode_" + fileName.replace(/\W+/g, "_");
  const savedCode = localStorage.getItem(storageKey);
  if (savedCode) codeInput.value = savedCode;
  codeInput.addEventListener("input", () =>
    localStorage.setItem(storageKey, codeInput.value)
  );

  // ===== LOGIN HANDLER =====
  codeInput.addEventListener("keyup", (e) => {
    if (e.key === "Enter") accessSubmit.click();
  });

  accessSubmit.addEventListener("click", async () => {
    const input = codeInput.value.trim();
    if (!input) {
      message.textContent = "Please enter the access code.";
      return;
    }

    accessSubmit.disabled = true;
    codeInput.disabled = true;
    message.textContent = "Checking...";

    try {
      const resp = await fetch(BIN_URL_CODE, {
        headers: { "X-Master-Key": MASTER_KEY_CODE, "Content-Type": "application/json" }
      });

      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();

      const remoteCode =
        findStringKey(data, "accessCode") ||
        findStringKey(data, "code") ||
        findStringKey(data, "access");

      if (!remoteCode) {
        message.textContent = "Access code not found in storage record.";
        throw new Error("No accessCode in JSON");
      }

      if (input === remoteCode.trim()) {
        accessSection.style.display = "none";
        mainContent.style.display = "block";
        message.textContent = "";
        saveLoginToJsonBin(input); // <<== AUTO LOG TO JSONBIN
        setTimeout(() => {
          const btn = document.querySelector("#mainContent button");
          if (btn) btn.focus();
        }, 100);
      } else {
        message.textContent = "Wrong code. Please refer to contact";
        localStorage.removeItem(storageKey);
        accessSubmit.disabled = false;
        codeInput.disabled = false;
      }
    } catch (err) {
      console.error("Access fetch error:", err);
      message.textContent = "Error fetching code. Check console for details.";
      accessSubmit.disabled = false;
      codeInput.disabled = false;
    }
  });

  // ===== QUIZ LOGIC =====
  const pool = [
  
  
    {q: "The ‚Äúquantum of proof‚Äù in criminal cases is:", choices: ["Preponderance of evidence", "Clear and convincing evidence", "Proof beyond reasonable doubt", "Probable cause", "Substantial evidence"], correctIndex: 2},
  {q: "What is cumulative evidence?", choices: ["A different type of evidence proving the same fact", "The same type of evidence repeatedly proving the same fact", "Evidence that cannot be admitted in court", "Evidence that contradicts witness testimony", "An admission made in court"], correctIndex: 1},
  {q: "Why do courts strictly require proof of chain of custody?", choices: ["To make the case move faster", "To prevent wrongful convictions", "To reduce paperwork in trial", "To protect police reputation", "To shorten court proceedings"], correctIndex: 1},
  {q: "Which statement BEST describes the authority to summon assistance during arrest?", choices: ["Only PNP officers can be summoned.", "Any person summoned by an officer must assist if able, without detriment to himself.", "Only government employees may assist in arrests.", "Only relatives of the accused may assist voluntarily.", "Summoned civilians cannot be compelled to help."], correctIndex: 1},
  {q: "Why is it important to package evidence correctly?", choices: ["To make the evidence appear more formal", "To avoid contamination, loss, or deterioration", "To hasten the trial proceedings", "To reduce paperwork requirements", "To improve the appearance of the evidence container"], correctIndex: 1},
  {q: "Under the amended law, the accused may not be held liable for rape even if the victim is above 16 but below 18, if the sexual intercourse is non-abusive, non-exploitative, and consensual, provided the age gap is _________.", choices: ["2", "3", "4", "5"], correctIndex: 1},
  {q: "What is the penalty if the driver involved in a motor vehicle accident refuses to undergo mandatory field sobriety and drug tests?", choices: ["Imprisonment", "Forced to undergo the test", "Permanent ban from driving", "Confiscation and revocation of the driver‚Äôs license", "Payment of a minimal fine"], correctIndex: 3},
  {q: "Why is proper evidence packaging important?", choices: ["To make evidence look official", "To prevent contamination, loss, or deterioration", "To speed up the court trial", "To minimize paperwork", "To decorate the evidence package"], correctIndex: 1},
  {q: "What is the primary characteristic of a mala prohibita crime in terms of criminal liability?", choices: ["The crime requires proof of criminal intent (mens rea)", "The crime is considered a personal wrong, affecting only the victim", "The crime is prohibited by law but is not inherently immoral or wrong", "The crime always carries a penalty of reclusion perpetua"], correctIndex: 2},
  {q: "Why do courts demand strict chain of custody?", choices: ["To speed up the case", "To avoid wrongful convictions", "To reduce paperwork", "To protect police reputation", "To make trials shorter"], correctIndex: 1},
  {q: "Under Philippine criminal law, what constitutes a complex crime of robbery with homicide?", choices: ["A person who steals property, but does not use violence.", "A person who commits robbery and, in the process, kills the victim.", "A person who kills another person while attempting to rob them but fails to take any property.", "A person who steals and commits homicide separately."], correctIndex: 1},
  {q: "Which of the following is an exception to the rule that a complaint or information must charge only one offense?", choices: ["When the accused is a minor", "When multiple victims are involved", "When the law prescribes a single punishment for various offenses", "When filed by a public prosecutor", "When approved by the court"], correctIndex: 2},
  {q: "What is true regarding the crime of rape by sexual intercourse according to new jurisprudential rulings?", choices: ["There must be penetration no matter how slight.", "Mere grazing of the labia minora or majora of the pudendum consummates rape.", "There must be tenacious resistance.", "The crime must be committed under duress."], correctIndex: 1},
  {q: "Who might question the accuracy of chain of custody in court?", choices: ["Judge", "Defense attorney", "Stenographer", "Victim‚Äôs family", "Prosecutor"], correctIndex: 1},
  {q: "What is the term used when an individual kills another person intentionally with qualifying circumstances?", choices: ["Homicide", "Murder", "Parricide", "Infanticide"], correctIndex: 1},
  {q: "What does mens rea mean under Philippine criminal law?", choices: ["The knowledge and intention to commit a crime.", "The act of committing a crime.", "The absence of intention to commit a crime.", "The punishment for committing a crime."], correctIndex: 0},
  {q: "Which of the following describes a ‚Äúdating relationship‚Äù?", choices: ["A romantic relationship over time", "A casual friendship", "A professional relationship", "A family relationship", "A relationship of dependency only"], correctIndex: 0},
  {q: "Juan repeatedly insults his wife Maria, threatens her, and withholds money for household needs, causing her emotional suffering. If Maria files a case under RA 9262, what form of abuse is being committed?", choices: ["Physical Abuse", "Sexual Abuse", "Psychological Violence", "Economic Abuse", "Emotional Negligence"], correctIndex: 2},
  {q: "Under Philippine law, what is the minimum age for criminal responsibility?", choices: ["9 years old", "12 years old", "15 years old", "18 years old"], correctIndex: 2},
  {q: "Which of the following is considered an aggravating circumstance under Philippine criminal law?", choices: ["The crime was committed in a public place", "The crime was committed with cruelty", "The crime was committed without premeditation", "The crime was committed under duress"], correctIndex: 1},
  {q: "Juan is a barangay kagawad. He learns that his nephew, Pedro, is being investigated by the police for selling shabu. To help Pedro evade arrest, Juan warns him and provides a safe house. He also lies to police saying Pedro is not involved. What is the prohibited act committed by Juan under RA No. 9165?", choices: ["Conspirator", "Protector or Coddler", "Pusher", "Possessor"], correctIndex: 1},
  {q: "Proper marking of evidence includes:", choices: ["Labeling and securing the item", "Using initials only", "Using invisible ink", "Leaving it unmarked until court", "Recording case number"], correctIndex: 0},
  {q: "Under Philippine law, when does a person‚Äôs criminal liability begin?", choices: ["Upon the commission of the crime", "Upon the arrest by the police", "Upon the filing of the complaint", "Upon the issuance of the arrest warrant"], correctIndex: 0},
  {q: "Upon arraignment in court, if the true name of the accused is later discovered, what must the court do?", choices: ["Dismiss the case", "Insert the true name in the complaint or information", "Restart preliminary investigation", "Require new affidavits", "Issue a new warrant automatically"], correctIndex: 1},
  {q: "Under the amended Revised Penal Code, which of the following actions is no longer considered 'alarm and scandal'?", choices: ["Public intoxication causing a disturbance", "Discharging a firearm in a public place", "A loud argument disturbing public peace", "Engaging in a charivari"], correctIndex: 3},
  {q: "Juan and Maria are married. Over years, Juan insults Maria in public, threatens to leave her, and withholds money, causing her anxiety and depression. If Maria files a case under RA 9262, what would be the ground?", choices: ["Physical Abuse", "Sexual Abuse", "Psychological Violence", "Economic Abuse"], correctIndex: 2},
  {q: "What does the Chain of Custody primarily ensure?", choices: ["Speed of evidence testing", "Integrity of evidence from collection to court", "Quick transfer to the prosecutor", "Secure police storage only", "Faster laboratory results"], correctIndex: 1}


  ];

  function pickRandom(arr, n) {
    const copy = [...arr];
    const result = [];
    while (result.length < n && copy.length > 0) {
      const idx = Math.floor(Math.random() * copy.length);
      result.push(copy.splice(idx, 1)[0]);
    }
    return result;
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function selectRandomChoices(item) {
    const correctChoice = item.choices[item.correctIndex];
    let others = item.choices.filter((_, idx) => idx !== item.correctIndex);
    shuffleArray(others);
    let selected = [correctChoice, ...others.slice(0, 4)];
    shuffleArray(selected);
    item.correctIndex = selected.indexOf(correctChoice);
    item.choices = selected;
  }

  let quizItems = [];

  window.showQuiz = function () {
    document.getElementById("reviewerSection").style.display = "none";
    document.getElementById("quizSection").style.display = "block";
    buildQuiz();
  };

  window.backToReviewer = function () {
    document.getElementById("quizSection").style.display = "none";
    document.getElementById("reviewerSection").style.display = "block";
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
  };

  window.refreshQuiz = function () {
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
    document.getElementById("finishBtn").disabled = false;
    buildQuiz();
  };

  function buildQuiz() {
    quizItems = pickRandom(pool, Math.min(20, pool.length));
    const form = document.getElementById("quizForm");
    form.innerHTML = "";
    quizItems.forEach((item, i) => {
      selectRandomChoices(item);
      const div = document.createElement("div");
      div.className = "question";
      const q = document.createElement("p");
      q.textContent = `${i + 1}. ${item.q}`;
      div.appendChild(q);
      item.choices.forEach((choice, idx) => {
        const label = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `q${i}`;
        radio.value = idx;
        label.appendChild(radio);
        label.appendChild(document.createTextNode(" " + choice));
        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });
      form.appendChild(div);
    });
  }

  document.getElementById("finishBtn").addEventListener("click", async function () {
    let score = 0;
    const total = quizItems.length;
    for (let i = 0; i < total; i++) {
      const radios = document.querySelectorAll(`input[name="q${i}"]`);
      let selected = -1;
      radios.forEach(r => { if (r.checked) selected = parseInt(r.value); });
      const div = document.getElementById("quizForm").children[i];
      if (selected === quizItems[i].correctIndex) {
        score++;
        div.insertAdjacentHTML("beforeend", "<div class='correct'>‚úî Correct</div>");
      } else {
        const correctAnswer = quizItems[i].choices[quizItems[i].correctIndex];
        div.insertAdjacentHTML("beforeend", `<div class='wrong'>‚úò Wrong. Correct: ${correctAnswer}</div>`);
      }
      radios.forEach(r => r.disabled = true);
    }
    document.getElementById("result").innerHTML = `<h2>Your Score: ${score} / ${total}</h2>`;
    this.disabled = true;

    // üß† Save score to JSONBin
    await saveScoreToJsonBin(score, total);
  });
});
</script>
</body>
</html>


